<!DOCTYPE html>

<html>
<head>
  <title>form.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="consciousness.html">
                  consciousness.js
                </a>
              
                
                <a class="source" href="form.html">
                  form.js
                </a>
              
                
                <a class="source" href="home.html">
                  home.js
                </a>
              
                
                <a class="source" href="product-list.html">
                  product-list.js
                </a>
              
                
                <a class="source" href="product.html">
                  product.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>form.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> url =
  <span class="hljs-string">&quot;https://usebasin.com/api/v1/submissions?form_id=ab2834d7e27b&amp;api_token=1cbd5d2e93116be3389923b4e8c5fd5d&quot;</span>;

<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">&quot;x-apikey&quot;</span>: <span class="hljs-string">&quot;61b64c7672a03f5dae822307&quot;</span>,
  },
};

<span class="hljs-keyword">let</span> today = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
<span class="hljs-keyword">let</span> lastDay = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();

<span class="hljs-keyword">const</span> dd = <span class="hljs-title class_">String</span>(today.<span class="hljs-title function_">getDate</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;0&quot;</span>);
<span class="hljs-keyword">const</span> mm = <span class="hljs-title class_">String</span>(today.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;0&quot;</span>); <span class="hljs-comment">//January is 0!</span>
<span class="hljs-keyword">const</span> yyyy = today.<span class="hljs-title function_">getFullYear</span>();

<span class="hljs-keyword">const</span> mmLast = <span class="hljs-title class_">String</span>(today.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">2</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;0&quot;</span>);

today = <span class="hljs-string">`<span class="hljs-subst">${dd}</span>-<span class="hljs-subst">${mm}</span>-<span class="hljs-subst">${yyyy}</span>`</span>;
lastDay = <span class="hljs-string">`<span class="hljs-subst">${dd}</span>-<span class="hljs-subst">${mmLast}</span>-<span class="hljs-subst">${yyyy}</span>`</span>;

<span class="hljs-keyword">let</span> datepicker;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getFormData</span>(<span class="hljs-params"></span>) {
  <span class="hljs-title function_">fetch</span>(url, options)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(updateForm);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getHours</span>(<span class="hljs-params"></span>) {
  <span class="hljs-title function_">fetch</span>(url, options)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(checkHoursAvailable);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">showHours</span>(<span class="hljs-params"></span>) {
  <span class="hljs-title function_">fetch</span>(url, options)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(showAvailableHours);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateForm</span>(<span class="hljs-params">a</span>) {
  <span class="hljs-keyword">const</span> elem = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;date&quot;</span>);
  datepicker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Datepicker</span>(elem, {
    <span class="hljs-attr">buttonClass</span>: <span class="hljs-string">&quot;btn&quot;</span>,
    <span class="hljs-attr">minDate</span>: today,
    <span class="hljs-attr">maxDate</span>: lastDay,
    <span class="hljs-attr">daysOfWeekDisabled</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">6</span>],
    <span class="hljs-attr">format</span>: <span class="hljs-string">&quot;dd/mm/yyyy&quot;</span>,
    <span class="hljs-attr">autohide</span>: <span class="hljs-literal">true</span>,
  });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getOccurrence</span>(<span class="hljs-params">array, value</span>) {
  <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
  array.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> v === value &amp;&amp; count++);
  <span class="hljs-keyword">return</span> count;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">checkHoursAvailable</span>(<span class="hljs-params">a</span>) {
  <span class="hljs-keyword">const</span> submissions = a.<span class="hljs-property">submissions</span>;
  <span class="hljs-keyword">let</span> dates = [];
  <span class="hljs-keyword">let</span> unavailableDays = [];

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; submissions.<span class="hljs-property">length</span>; i++) {
    dates.<span class="hljs-title function_">push</span>(submissions[i].<span class="hljs-property">payload_params</span>.<span class="hljs-property">date</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">getOccurrence</span>(dates, submissions[i].<span class="hljs-property">payload_params</span>.<span class="hljs-property">date</span>) === <span class="hljs-number">3</span>) {
      unavailableDays.<span class="hljs-title function_">push</span>(submissions[i].<span class="hljs-property">payload_params</span>.<span class="hljs-property">date</span>);
      datepicker.<span class="hljs-title function_">setOptions</span>({ <span class="hljs-attr">datesDisabled</span>: unavailableDays });
    }
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">showAvailableHours</span>(<span class="hljs-params">a</span>) {
  <span class="hljs-keyword">const</span> hSubmissions = a.<span class="hljs-property">submissions</span>;
  <span class="hljs-keyword">const</span> selectedDay = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#date&quot;</span>).<span class="hljs-property">value</span>;
  <span class="hljs-keyword">const</span> textHours = [<span class="hljs-string">&quot;11-00&quot;</span>, <span class="hljs-string">&quot;12-00&quot;</span>, <span class="hljs-string">&quot;13-00&quot;</span>];

  <span class="hljs-keyword">const</span> temp = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;template&quot;</span>).<span class="hljs-property">content</span>;
  <span class="hljs-keyword">const</span> clone = temp.<span class="hljs-title function_">cloneNode</span>(<span class="hljs-literal">true</span>);

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; hSubmissions.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (hSubmissions[i].<span class="hljs-property">payload_params</span>.<span class="hljs-property">date</span> === selectedDay) {
      hSubmissions[i].<span class="hljs-property">payload_params</span>.<span class="hljs-property">time</span> = hSubmissions[
        i
      ].<span class="hljs-property">payload_params</span>.<span class="hljs-property">time</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;:&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>);
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">getOccurrence</span>(textHours, hSubmissions[i].<span class="hljs-property">payload_params</span>.<span class="hljs-property">time</span>) === <span class="hljs-number">1</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;ana&quot;</span>);
        clone
          .<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">`#container-<span class="hljs-subst">${hSubmissions[i].payload_params.time}</span>`</span>)
          .<span class="hljs-title function_">remove</span>();
      }
    }
  }

  <span class="hljs-keyword">const</span> avTimes = clone.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#times&quot;</span>);
  <span class="hljs-keyword">const</span> firstTime = avTimes.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;div:first-of-type&quot;</span>);
  <span class="hljs-keyword">const</span> firstTimeInput = firstTime.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;input&quot;</span>);

  firstTimeInput.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;checked&quot;</span>, <span class="hljs-literal">true</span>);

  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#time&quot;</span>).<span class="hljs-title function_">appendChild</span>(clone);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(selectedDay);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hSubmissions);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">makeDayClick</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> calendar = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;.datepicker-grid&quot;</span>);
  <span class="hljs-keyword">const</span> nextButton = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;.next-btn&quot;</span>);
  <span class="hljs-keyword">const</span> prevButton = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;.prev-btn&quot;</span>);
  <span class="hljs-keyword">let</span> availableDays = calendar.<span class="hljs-title function_">querySelectorAll</span>(
    <span class="hljs-string">&quot;.datepicker-cell:not(.disabled)&quot;</span>
  );

  <span class="hljs-title function_">getHours</span>();

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">dayIsClicked</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">let</span> t = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#time-options&quot;</span>)) {
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#time-options&quot;</span>).<span class="hljs-title function_">remove</span>();
    }

    availableDays.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">d</span>) =&gt;</span> {
      d.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, dayIsClicked);
    });

    nextButton.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, nextClicked);
    prevButton.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, nextClicked);

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#time-options&quot;</span>)) {
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#time-options&quot;</span>).<span class="hljs-title function_">remove</span>();
    }

    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#date&quot;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, makeDayClick);

    <span class="hljs-title function_">showHours</span>();
  }

  availableDays.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">d</span>) =&gt;</span> {
    d.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, dayIsClicked);
  });

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">nextClicked</span>(<span class="hljs-params"></span>) {
    availableDays = calendar.<span class="hljs-title function_">querySelectorAll</span>(
      <span class="hljs-string">&quot;.datepicker-cell:not(.disabled)&quot;</span>
    );

    <span class="hljs-keyword">const</span> unDays = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&quot;.datepicker-cell.disabled&quot;</span>);

    unDays.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">z</span>) =&gt;</span> {
      z.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, dayIsClicked);
    });

    availableDays.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">d</span>) =&gt;</span> {
      d.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, dayIsClicked);
    });
  }

  nextButton.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, nextClicked);
  prevButton.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, nextClicked);
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#date&quot;</span>).<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, makeDayClick);
}

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#date&quot;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, makeDayClick);

<span class="hljs-title function_">getFormData</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <p>input box, as well as the span element into which we will place the error message.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> form = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">&quot;form&quot;</span>)[<span class="hljs-number">0</span>];

<span class="hljs-keyword">const</span> email = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;email&quot;</span>);
<span class="hljs-keyword">const</span> emailError = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#input-info + span.error&quot;</span>);

email.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;input&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <p>Each time the user types something, we check if the
form fields are valid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">if</span> (email.<span class="hljs-property">validity</span>.<span class="hljs-property">valid</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <p>In case there is an error message visible, if the field
is valid, we remove the error message.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    emailError.<span class="hljs-property">textContent</span> = <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-comment">// Reset the content of the message</span>
    emailError.<span class="hljs-property">className</span> = <span class="hljs-string">&quot;error&quot;</span>; <span class="hljs-comment">// Reset the visual state of the message</span>
  } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p>If there is still an error, show the correct error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-title function_">showError</span>();
  }
});

form.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;submit&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p>if the email field is valid, we let the form submit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">if</span> (!email.<span class="hljs-property">validity</span>.<span class="hljs-property">valid</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p>If it isn’t, we display an appropriate error message</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-title function_">showError</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p>Then we prevent the form from being sent by canceling the event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    event.<span class="hljs-title function_">preventDefault</span>();
  }
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">showError</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">if</span> (email.<span class="hljs-property">validity</span>.<span class="hljs-property">valueMissing</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <p>If the field is empty,
display the following error message.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    emailError.<span class="hljs-property">textContent</span> = <span class="hljs-string">&quot;You need to enter an e-mail address.&quot;</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (email.<span class="hljs-property">validity</span>.<span class="hljs-property">typeMismatch</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <p>If the field doesn’t contain an email address,
display the following error message.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    emailError.<span class="hljs-property">textContent</span> = <span class="hljs-string">&quot;Entered value needs to be an e-mail address.&quot;</span>;
  }

  emailError.<span class="hljs-property">className</span> = <span class="hljs-string">&quot;error active&quot;</span>;
}

<span class="hljs-keyword">const</span> dbUrl = <span class="hljs-string">&quot;https://gnmmd2ndsemester-6f2a.restdb.io/rest/akva&quot;</span>;
<span class="hljs-keyword">const</span> dbOptions = {
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">&quot;x-apikey&quot;</span>: <span class="hljs-string">&quot;61b64c7672a03f5dae822307&quot;</span>,
  },
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getRestData</span>(<span class="hljs-params"></span>) {
  <span class="hljs-title function_">fetch</span>(dbUrl, dbOptions)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(chooseProduct);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">chooseProduct</span>(<span class="hljs-params">p</span>) {
  <span class="hljs-keyword">const</span> template = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;template&quot;</span>).<span class="hljs-property">content</span>;

  p.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> chooseOption = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;option&quot;</span>);
    chooseOption.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;value&quot;</span>, <span class="hljs-string">`<span class="hljs-subst">${e.title}</span>`</span>);
    chooseOption.<span class="hljs-property">textContent</span> = e.<span class="hljs-property">title</span>;
    template.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;select&quot;</span>).<span class="hljs-title function_">appendChild</span>(chooseOption);
  });
}

<span class="hljs-title function_">getRestData</span>();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
